<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>TOBI AI App Builder</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:#0b0f14;color:#f1f5f9;margin:0;padding:0}
    header{padding:24px 16px;border-bottom:1px solid #1f2937;background:#0f1620;position:sticky;top:0}
    .container{max-width:920px;margin:0 auto;padding:24px 16px}
    .card{background:#0f172a;border:1px solid #1f2937;border-radius:16px;padding:20px;box-shadow:0 6px 24px rgba(0,0,0,.25)}
    label{display:block;margin:12px 0 6px;color:#cbd5e1}
    input,textarea,select{width:100%;padding:12px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:#e5e7eb}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    button{padding:12px 16px;border-radius:12px;border:0;background:#2563eb;color:white;font-weight:600;cursor:pointer}
    button:disabled{opacity:.5;cursor:not-allowed}
    .tag{display:inline-block;padding:6px 10px;border:1px solid #334155;border-radius:999px;margin-right:8px;margin-bottom:8px}
    footer{color:#94a3b8;font-size:12px;margin-top:16px}
    a{color:#93c5fd}
    .small{font-size:12px;color:#9ca3af}
    .inline{display:flex;gap:8px;align-items:center}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>TOBI AI App Builder</h1>
      <p class="small">Describe the app you want. Get a downloadable starter project (zip) generated by Gemini â€” via your server key.</p>
    </div>
  </header>
  <main class="container">
    <div class="card">
      <div class="row">
        <div>
          <label>App name</label>
          <input id="appName" placeholder="My Amazing App"/>
        </div>
        <div>
          <label>Target</label>
          <select id="target">
            <option>web</option>
            <option>mobile</option>
            <option>backend/api</option>
            <option>desktop</option>
          </select>
        </div>
      </div>
      <label>Description</label>
      <textarea id="description" rows="6" placeholder="What should your app do? Be specific about features, data, APIs..."></textarea>
      <label>Frameworks / Stack (comma separated)</label>
      <input id="frameworks" placeholder="e.g., React, Next.js, Express, Tailwind, Flask"/>
      <div class="inline" style="margin:12px 0 0">
        <input type="checkbox" id="auth"/>
        <label for="auth" style="margin:0">Include authentication (basic)</label>
      </div>
      <div style="margin-top:16px" class="inline">
        <button id="buildBtn">Build App</button>
        <div id="status" class="small"></div>
      </div>
    </div>
    <footer>
      <p>Server must have <code>GEMINI_API_KEY</code> set. Your key never leaves your server.</p>
    </footer>
  </main>
  <script>
    const btn = document.getElementById('buildBtn');
    const status = document.getElementById('status');
    btn.addEventListener('click', async () => {
      const payload = {
        appName: document.getElementById('appName').value || 'MyApp',
        description: document.getElementById('description').value,
        target: document.getElementById('target').value,
        frameworks: (document.getElementById('frameworks').value || '').split(',').map(s=>s.trim()).filter(Boolean),
        includeAuth: document.getElementById('auth').checked
      };
      btn.disabled = true;
      status.textContent = "Generating...";
      try {
        const res = await fetch('/api/build', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!res.ok) {
          const err = await res.json().catch(()=>({error:res.statusText}));
          throw new Error(err.error || 'Failed');
        }
        const blob = await res.blob();
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = (payload.appName || 'app') + '.zip';
        a.click();
        URL.revokeObjectURL(a.href);
        status.textContent = "Done. Zip downloaded.";
      } catch (e) {
        status.textContent = e.message || "Failed";
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
